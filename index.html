<!doctype html>
<html>
    <head>
        <style>
            #cy, #graph, #info {
                height: 80%;
                width: 100%;
                position: absolute;
                left: 0;
                top: 40px;
            }
            #info {
                margin: 50px;
            }
            #myChart {
                height: 100%;
                width: 100%;
            }
            #messages {
                max-height: 20%;
                width: 100%;
                position: absolute;
                bottom:0;
                left:0;
                margin: 0;
                overflow:hidden;
                overflow-y: auto;
            }
            .ui.header.small {
                font-size: 14px;
            }
            .nav {
                position:absolute;
                top:0;
            }
        </style>
        <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.css">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.css">
        <script src='https://cdn.socket.io/socket.io-1.4.5.js'></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.2.0/jquery.qtip.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.min.js"></script>
        <script src="http://cytoscape.github.io/cytoscape.js/api/cytoscape.js-latest/cytoscape.min.js"></script>
        <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-qtip/2.2.5/cytoscape-qtip.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>


        <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.10/c3.min.js"></script>

        <script>
            $( document ).ready(function() {

                $("#network_nav").click(function() {
                    $("#graph").hide(250);
                    $("#info").hide(250);
                    $("#cy").show(250);
                    $("#graph_nav").removeClass("active");
                    $("#info_nav").removeClass("active");
                    $("#network_nav").addClass("active");
                });
                $("#graph_nav").click(function() {
                    $("#info").hide(250);
                    $("#cy").hide(250);
                    $("#graph").show(250);
                    $("#graph_nav").addClass("active");
                    $("#info_nav").removeClass("active");
                    $("#network_nav").removeClass("active");

                });
                $("#info_nav").click(function() {
                    $("#graph").hide(250);
                    $("#cy").hide(250);
                    $("#info").show(250);
                    $("#graph_nav").removeClass("active");
                    $("#info_nav").addClass("active");
                    $("#network_nav").removeClass("active");

                });
                var chart; 
            });
            String.prototype.cap = function() {
                return this.charAt(0).toUpperCase() + this.slice(1);
            }
            function pad(i) {
                return (i < 10 ? "0" : "") + i
            }
            var socket = io();
            socket.on('update', function(data) {
                cy.$('#'+data["id"]).data('color', data["color"]);
                date = new Date()
                $("#messages").prepend(pad(date.getHours()) + ":" + pad(date.getMinutes()) + ":" + pad(date.getSeconds()) + " - <span class=\"ui " + data["color"] + " small inverted header\">" + data["color"].cap() + "<\/span> team has claimed " + data["id"] + "<br/>");
                    chart.load({
                        columns: data["chart"]
                    });
                        
                });
                socket.on('data', function(data) {
                    chart = c3.generate({
                        bindto: '#chart',
                        data: {
                            columns: data["chart"]
                        },
                        color: {
                            pattern: data["colors"]
                        }
                    });
                    var cy = window.cy = cytoscape({
                        container: document.getElementById('cy'),
                        ready: function(){},        
                        layout: {
                            name: 'cose',
                            padding: 10
                        },

                        style: cytoscape.stylesheet()
                        .selector('node')
                        .css({
                            'content': 'data(name)',
                            'text-valign': 'center',
                            'text-outline-width': 2,
                            'text-outline-color': 'data(color)',
                            'background-color': 'data(color)',
                            'color': '#fff'
                        })
                        .selector(':selected')
                        .css({
                            'border-width': 3,
                            'border-color': '#333'
                        })
                        .selector('edge')
                        .css({
                            'opacity': 0.666,
                            'line-color': 'data(color)',
                        })
                        .selector('.faded')
                        .css({
                            'opacity': 0.25,
                            'text-opacity': 0
                        }),
                        elements: data.graph,
                    });
                    cy.elements('node').qtip({
                        content: function() { return this.data("ip") ; },
                        position: {
                            my: 'top center',
                            at: 'bottom center'                 
                        },
                        show: {
                            event: 'mouseover'
                        },
                        hide: {
                            event: 'mouseout'
                        },
                        style: {
                            classes: 'qtip-bootstrap',
                            tip: {
                                width: 16,
                                height: 8
                            }
                        }
                    });
                    $("#graph").hide()
                    $("#info").hide()
                    $("#cy").show()

                });

                socket.on('time', function(data) {
                    addMessage(data.time);
                });
                socket.on('error', console.error.bind(console));
                socket.on('message', console.log.bind(console));
            </script>
        </head>
        <body>
            <nav class="ui fixed menu inverted navbar">
            <a href="#" class="brand item">King of the Hill</a>
            <a id="network_nav" href="#" class="active item">Network</a>
            <a id="graph_nav" href="#" class="item">Graph</a>
            <a id="info_nav" href="#" class="item">Info</a>
            </nav>
            <div id="cy"></div>
            <div id="graph"><div id="chart" class="c3"> </div></div>
            <div id="info">
                <h1 class="ui header">Welcome to KOTH</h1>
                <h2 class="ui dividing header">
                    <i class="info icon"></i>
                    <div class="content">
                        What is KOTH?
                    </div>
                </h2>
                <h5>KOTH stands for "King of the Hill", and is a new type of cybersecurity competition. </h5>
                <h2 class="ui dividing header">
                    <i class="sitemap icon"></i>
                    <div class="content">
                        Network Map
                    </div>
                </h2>
                <h2 class="ui dividing header">
                    <i class="line chart icon"></i>
                    <div class="content">
                        Graph Map
                    </div>
                </h2>

            </div>
            <div id="messages" class="ui inverted segment"></div>
        </body>
    </html>
